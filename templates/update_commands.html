{% extends "base.html" %}

{% block header %} Add Commands {% endblock %}

{% block contents %}

<div class="main">
    <div class="container mt-5 pt-5">
        <div class="row">
            <div class="col-12 col-sm-8 col-md-8 col-lg-8 m-auto">
                <div class="card border-0 shadow p-3">
                    <ul class="nav nav-underline nav-justified justify-content-center mb-5">
                        <li class="nav-item">
                            <button class="nav-link active tab-btn" data-bs-toggle="tab" data-bs-target="#add-command" type="button" role="tab">
                                Add Command
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#delete-command" type="button" role="tab">
                                Delete Command
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content card-body text-center pt-0">
                        <!-- Add Command -->
                        <div class="tab-pane fade show active"
                            id="add-command" role="tabpanel" aria-labelledby="ip-lookup" tabindex="0">
                            
                            <input type="text" class="form-control" id="cmd-name" placeholder="Name your command...">
                            <div id="add-argument" class="d-flex flex-column flex-md-row my-3 gap-2">
                                <input type="text" class="form-control mb-2 mb-md-0" placeholder="-c">
                                <input type="text" class="form-control mb-2 mb-md-0" placeholder="GetBiosInfo">
                                <button id="btn-add-cmd" class="custom-btn" style="background: none; border: none; cursor: pointer; outline: none;">
                                    <i class="bi bi-plus-circle-fill fs-4"></i>
                                </button>
                            </div>
                            <div id="example-cmd"></div>
                            <div class="d-grid gap-2 mt-4 m-auto">
                                <div class="d-flex justify-content-center gap-2">
                                    <button class="btn btn-dark" onclick="addCommand()">Add</button>
                                    <button class="btn btn-outline-dark" onclick="resetInput()">Reset</button>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade show"
                            id="delete-command" role="tabpanel" aria-labelledby="ip-lookup" tabindex="0">
                            <select class="form-select" id="selected-command" name="selected-command">
                                <option value="" selected>Choose task</option>
                            </select>
                            <div class="d-grid gap-2 mt-4 m-auto">
                                <div class="d-flex justify-content-center gap-2">
                                    <button class="btn btn-dark" onclick="deleteCommand()">Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

{% endblock %}

{% block scripts %}

<script>
    const btnAddCmd = document.getElementById('btn-add-cmd');
    const addArgument = document.getElementById('add-argument');
    const exampleCmd = document.getElementById('example-cmd');
    const preDefinedText = 'Example: tool -U ADMIN -P PASSWORD ';

    // Add each input value to the command 
    function updateExampleCmd() {
        let inputs = addArgument.querySelectorAll('input');
        let cmdText = '';
        inputs.forEach(input => {
            if (input.value.trim() !== '') {
                cmdText += input.value.replace(/\s+/g, '') + ' '; // Remove spaces -- making sure one textbox per argument
            }
        });
        // showing the command example per user input
        exampleCmd.textContent = preDefinedText + cmdText.trim();
    }

    // Add event listener to add command button
    btnAddCmd.addEventListener('click', function() {
        let inputCount = addArgument.childElementCount - 2;
        if (inputCount > 6) {
            alert(`Maximum of ${inputCount + 1} arguments only!`);
            return;
        }
        const newInput = document.createElement('input');
        newInput.type = 'text';
        newInput.className = 'form-control';
        newInput.placeholder = `Arg ${inputCount}`;
        newInput.addEventListener('input', updateExampleCmd);
        addArgument.insertBefore(newInput, btnAddCmd);
    });

    // Show real-time example command
    addArgument.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', updateExampleCmd);
    });
    

    // Add command to the list
    function addCommand() {
        let cmdName = document.getElementById('cmd-name').value;
        let cmdArgs = [];
        addArgument.querySelectorAll('input').forEach(input => {
            if (input.value.trim() !== '') {
                cmdArgs.push(input.value.trim());
            }
        });
        console.log(cmdName, cmdArgs);
        return {'cmdName': cmdName, 'cmdArgs': cmdArgs};
    }


    // Delete command from the list
    function resetInput() {
        document.getElementById('cmd-name').value = '';
        addArgument.querySelectorAll('input').forEach((input, index) => {
            if (index > 1) {
                input.remove();
            } else {
                input.value = '';
            }
        });
        exampleCmd.textContent = "";
    }


</script>

{% endblock %}